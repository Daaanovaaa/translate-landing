<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Translate This Newsletter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        button {
            margin: 5px;
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
        }
        #url-input, #submit-url {
            display: none;
            margin: 20px auto;
            padding: 10px;
            width: 80%;
            max-width: 500px;
        }
    </style>
</head>
<body>
    <h2>ğŸŒ Translate This Newsletter</h2>
    <p>Select your language to open a translated version of this newsletter:</p>

    <button data-lang="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</button>
    <button data-lang="fr">ğŸ‡«ğŸ‡· FranÃ§ais</button>
    <button data-lang="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</button>
    <button data-lang="de">ğŸ‡©ğŸ‡ª Deutsch</button>
    <button data-lang="zh-CN">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</button>
    <button data-lang="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
    <button data-lang="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</button>
    <button data-lang="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</button>
    <button data-lang="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</button>

    <input type="text" id="url-input" placeholder="Paste the 'View in Browser' URL here">
    <button id="submit-url">Submit URL</button>

    <script>
        // Valid language codes for Google Translate
        const validLanguages = ['es', 'fr', 'pt', 'de', 'zh-CN', 'ar', 'hi', 'ja', 'ru'];

        // Function to build and open Google Translate URL
        function openTranslateURL(lang, url) {
            if (!validLanguages.includes(lang)) {
                alert('Invalid language selected. Please try another.');
                return;
            }
            if (!url || url.includes('example.com')) {
                alert('No valid newsletter URL provided. Please paste the "View in Browser" URL.');
                document.getElementById('url-input').style.display = 'block';
                document.getElementById('submit-url').style.display = 'block';
                return;
            }
            const translateURL = `https://translate.google.com/translate?sl=auto&tl=${lang}&u=${encodeURIComponent(url)}&_x_tr_pto=wapp`;
            window.open(translateURL, '_blank');
        }

        // Get query parameter from URL
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // Check for lang parameter and attempt translation immediately
        const lang = getQueryParam('lang');
        const referrer = document.referrer;

        if (lang && validLanguages.includes(lang)) {
            if (referrer && !referrer.includes('github.io')) {
                openTranslateURL(lang, referrer);
            } else {
                // Show input field for manual URL entry
                document.getElementById('url-input').style.display = 'block';
                document.getElementById('submit-url').style.display = 'block';
                alert('Please paste the "View in Browser" URL from your email and click Submit.');
            }
        }

        // Handle button clicks
        document.querySelectorAll('button[data-lang]').forEach(button => {
            button.addEventListener('click', () => {
                const lang = button.getAttribute('data-lang');
                if (referrer && !referrer.includes('github.io')) {
                    openTranslateURL(lang, referrer);
                } else {
                    document.getElementById('url-input').style.display = 'block';
                    document.getElementById('submit-url').style.display = 'block';
                    alert('Please paste the "View in Browser" URL from your email and click Submit.');
                }
            });
        });

        // Handle manual URL submission
        document.getElementById('submit-url').addEventListener('click', () => {
            const manualURL = document.getElementById('url-input').value.trim();
            const selectedLang = lang || getQueryParam('lang') || 'es'; // Default to 'es' if no lang specified
            openTranslateURL(selectedLang, manualURL);
        });
    </script>
</body>
</html>
