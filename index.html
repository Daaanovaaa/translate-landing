<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Translate This Newsletter (Mirrored URL Version)</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        button { margin: 5px; padding: 10px 15px; font-size: 16px; cursor: pointer; }
        #url-display { margin: 20px; font-weight: bold; word-break: break-all; color: green; }
        #error-message { color: red; }
        #url-input, #submit-url { display: none; margin: 20px auto; padding: 10px; width: 80%; max-width: 500px; }
    </style>
</head>
<body>
    <h2>🌍 Translate This Newsletter</h2>
    <p>The mirrored URL from your browser header (referrer):</p>
    <div id="url-display">Loading...</div>
    <div id="error-message"></div>
    <p>If the URL above is correct, select a language below to translate it. If not, paste the full "View in Browser" URL below.</p>

    <button data-lang="es">🇪🇸 Español</button>
    <button data-lang="fr">🇫🇷 Français</button>
    <button data-lang="pt">🇵🇹 Português</button>
    <button data-lang="de">🇩🇪 Deutsch</button>
    <button data-lang="zh-CN">🇨🇳 中文</button>
    <button data-lang="ar">🇸🇦 العربية</button>
    <button data-lang="hi">🇮🇳 हिन्दी</button>
    <button data-lang="ja">🇯🇵 日本語</button>
    <button data-lang="ru">🇷🇺 Русский</button>

    <input type="text" id="url-input" placeholder="Paste the full 'View in Browser' URL here">
    <button id="submit-url">Use This URL</button>

    <script>
        const validLanguages = ['es', 'fr', 'pt', 'de', 'zh-CN', 'ar', 'hi', 'ja', 'ru'];

        function openTranslateURL(lang, url) {
            if (!validLanguages.includes(lang)) {
                alert('Invalid language selected.');
                return;
            }
            if (!isValidMailchimpURL(url)) {
                alert('Invalid URL. Please ensure it is a full Mailchimp "View in Browser" URL.');
                return;
            }
            const translateURL = `https://translate.google.com/translate?sl=auto&tl=${lang}&u=${encodeURIComponent(url)}&_x_tr_pto=wapp`;
            window.open(translateURL, '_blank');
        }

        function isValidMailchimpURL(url) {
            return url.startsWith('https://') && url.includes('campaign-archive.com/') && url.includes('?e=') && url.includes('&u=') && url.includes('&id=');
        }

        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        let newsletterUrl = document.referrer;
        const lang = getQueryParam('lang');
        const urlDisplay = document.getElementById('url-display');
        const errorMessage = document.getElementById('error-message');
        const urlInput = document.getElementById('url-input');
        const submitUrl = document.getElementById('submit-url');

        if (newsletterUrl && isValidMailchimpURL(newsletterUrl)) {
            urlDisplay.textContent = newsletterUrl;
            if (lang && validLanguages.includes(lang)) {
                openTranslateURL(lang, newsletterUrl);
            }
        } else {
            urlDisplay.textContent = newsletterUrl || 'No URL detected.';
            errorMessage.textContent = 'The mirrored URL is incomplete or missing. Please paste the full URL from your browser address bar below.';
            urlInput.style.display = 'block';
            submitUrl.style.display = 'block';
        }

        document.querySelectorAll('button[data-lang]').forEach(button => {
            button.addEventListener('click', () => {
                const selectedLang = button.getAttribute('data-lang');
                openTranslateURL(selectedLang, newsletterUrl);
            });
        });

        submitUrl.addEventListener('click', () => {
            newsletterUrl = urlInput.value.trim();
            if (isValidMailchimpURL(newsletterUrl)) {
                urlDisplay.textContent = newsletterUrl;
                errorMessage.textContent = '';
                urlInput.style.display = 'none';
                submitUrl.style.display = 'none';
                if (lang && validLanguages.includes(lang)) {
                    openTranslateURL(lang, newsletterUrl);
                }
            } else {
                errorMessage.textContent = 'Invalid URL. Please paste a valid Mailchimp "View in Browser" URL.';
            }
        });
    </script>
</body>
</html>
